define ("quiz_teacheroverview/participants",["jquery","core/str","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],function(a,b,c,d,e,f,g){var h={SENDMESSAGESBUTTON:"#sendmessage"},i=function(a){this.courseId=a.courseid;this.noteStateNames=a.noteStateNames;this.stateHelpIcon=a.stateHelpIcon;this.attachEventListeners()};i.prototype.modal=null;i.prototype.courseId=-1;i.prototype.noteStateNames={};i.prototype.stateHelpIcon="";i.prototype.attachEventListeners=function(){a(h.SENDMESSAGESBUTTON).on("click",function(b){b.preventDefault();a("#participantsform #checkboxes").html("");var c=[];a("input[name=\"attemptid[]\"]:checked").each(function(){c.push(a(this).data("userid"))});if(0==c.length){return}i.prototype.showSendMessage(c).fail(f.exception)})};i.prototype.showSendMessage=function(f){if(0==f.length){return a.Deferred().resolve().promise()}var g=null;if(1==f.length){g=b.get_string("sendbulkmessagesingle","core_message")}else{g=b.get_string("sendbulkmessage","core_message",f.length)}return a.when(c.create({type:c.types.SAVE_CANCEL,body:e.render("core_user/send_bulk_message",{})}),g).then(function(b,c){this.modal=b;this.modal.setTitle(c);this.modal.setSaveButtonText(c);this.modal.getRoot().on(d.hidden,function(){a(h.BULKACTIONSELECT).focus();this.modal.getRoot().remove()}.bind(this));this.modal.getRoot().on(d.save,this.submitSendMessage.bind(this,f));this.modal.show();return this.modal}.bind(this))};i.prototype.submitSendMessage=function(a){var c=this.modal.getRoot().find("form textarea").val(),d=[],e=0;for(e=0;e<a.length;e++){d.push({touserid:a[e],text:c})}return g.call([{methodname:"core_message_send_instant_messages",args:{messages:d}}])[0].then(function(a){if(1==a.length){return b.get_string("sendbulkmessagesentsingle","core_message")}else{return b.get_string("sendbulkmessagesent","core_message",a.length)}}).then(function(a){f.addNotification({message:a,type:"success"});return!0}).catch(f.exception)};return{load:function load(a){var b=this;g.call([{methodname:"quiz_teacheroverview_get_init_params",args:{courseid:a},done:function done(a){var a=JSON.parse(a.params);options=a;b.init(options)},fail:{}}])},init:function init(a){return new i(a)}}});
//# sourceMappingURL=participants.min.js.map
